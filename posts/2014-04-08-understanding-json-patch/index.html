<!DOCTYPE html>
<html lang="en">
<head>

<title>Understanding JSON Patch | Kevin Sookocheff</title>

<meta charset="utf-8">
<meta http-equiv="content-type", content="text/html; charset=utf-8">
<meta name="viewport", content="width=device-width, initial-scale=1.0">

<meta name="description" content="&lt;t render=&quot;markdown&quot;&gt;The typical update cycle for an API resource is to (1) GET the representation, (2) modify it and (3) PUT back the entire representation. This can waste bandwidth and processing time for large resources. An alternative is to use the [HTTP PATCH](https://tools.ietf.org/html/rfc5789) extension method to only send the differences between two resources. HTTP PATCH applies a set of changes to the document referenced by the HTTP request. Let's examine the JSON Patch format for HTTP PATCH requests.&lt;/t&gt;">
<meta name="keywords" content="">
<meta name="author" content="Kevin Sookocheff">

<link  rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" /><link  rel="stylesheet" href="/styles/vendor/bootstrap.min.css" /><link  rel="stylesheet" href="/styles/style.css" /><link  rel="stylesheet" href="/styles/monokai_sublime.css" /><link  rel="stylesheet" href="//fonts.googleapis.com/css?family=Bree+Serif" /><link  rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-20611089-6', 'sookocheff.com');
  ga('send', 'pageview');
</script>


<!--[if lt IE 9]>
<script async src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.2.0/respond.js"></script>
<![endif]-->

</head>
<body>

<!-- Navbar-->
<div class="navbar navbar-default">
  <div class="container">
    <div class="navbar-header">
      <button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">Kevin Sookocheff</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        
        <li class="inactive">
          <a href="/blog/">Blog</a>
        </li>
        <li class="inactive">
          <a href="/archives/">Archives</a>
        </li>
        <li class="dropdown">
          <a href="#" data-toggle="dropdown" class="dropdown-toggle">
            Subscribe <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li><a href="http://eepurl.com/KJE01">email</a></li>
            <li><a href="http://sookocheff.com/rss.xml">RSS</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Default Content -->
<!-- Page Container -->
<div class="container page-container">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <section class="page">
        <div class="page-header">
        
          <h1>Understanding JSON Patch</h1>
        
        </div>
        <div class="page-content">
          <article class="post">
  <p>
    <small class="text-muted">
      Posted on Tuesday, April 08, 2014.


    </small>
  </p>

  <div class=".post-content">
    <p>The typical update cycle for an API resource is to (1) GET the representation, (2) modify it and (3) PUT back the entire representation. This can waste bandwidth and processing time for large resources. An alternative is to use the <a href="https://tools.ietf.org/html/rfc5789">HTTP PATCH</a> extension method to only send the differences between two resources. HTTP PATCH applies a set of changes to the document referenced by the HTTP request.</p>
<pre class="highlight"><code class="hljs bash">PATCH /file.txt HTTP/<span class="hljs-number">1.1</span>
Host: sookocheff.com
Content-Type: application/json
If-Match: <span class="hljs-string">"e0036bbc6f"</span>

[description of changes]
</code></pre>
<p>The format of the PATCH request body differs depending on the representation of the resource. For JSON documents, <a href="https://tools.ietf.org/html/rfc6902">JSON Patch</a> defines this format.</p>
<p>A JSON Patch document is a sequential list of operations to be applied to an object. Each operation is a JSON object having exactly one <code>op</code> member.
Valid operations are <code>add</code>, <code>remove</code>, <code>replace</code>, <code>move</code>, <code>copy</code> and <code>test</code>. Any other operation is considered an error. </p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"add"</span> </span>}
</code></pre>
<p>Each operation must also have exactly one <code>path</code> member. 
The <code>path</code> member is a <a href="https://tools.ietf.org/html/rfc6901">JSON Pointer</a> that determines a location within the JSON document to modify.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"add"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/player/name"</span> </span>}
</code></pre>
<p>The remaining elements of a JSON Patch operation depend on the particular operation being performed.</p>
<h3 id="add">add</h3>
<p>The <code>add</code> operation is used in different ways depending on the target of the <code>path</code> being referenced. Generally speaking we can use <code>add</code> to append to a list, add a member to an object or update the value of an existing field. The <code>add</code> operation accepts a <code>value</code> member which is the value to update the referenced <code>path</code>. </p>
<h4 id="append-to-a-list">Append to a List</h4>
<p>To append a value to a list you use an existing list as the <code>path</code> of the operation. So, given the JSON document.</p>
<pre class="highlight"><code class="hljs bash">{
    <span class="hljs-string">"orders"</span>: [{<span class="hljs-string">"id"</span>: <span class="hljs-number">123</span>}, {<span class="hljs-string">"id"</span>: <span class="hljs-number">456</span>}]
}
</code></pre>
<p>We can append an order to the list using the <code>add</code> operation.</p>
<pre class="highlight"><code class="hljs bash">{ <span class="hljs-string">"op"</span>: <span class="hljs-string">"add"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/orders"</span>, <span class="hljs-string">"value"</span>: {<span class="hljs-string">"id"</span>: <span class="hljs-number">789</span>} }
</code></pre>
<p>After applying the patch we get the final document.</p>
<pre class="highlight"><code class="hljs bash">{
    <span class="hljs-string">"orders"</span>: [{<span class="hljs-string">"id"</span>: <span class="hljs-number">123</span>}, {<span class="hljs-string">"id"</span>: <span class="hljs-number">456</span>}, {<span class="hljs-string">"id"</span>: <span class="hljs-number">789</span>}]
}
</code></pre>
<h4 id="add-a-member-to-an-object">Add a Member to an Object</h4>
<p>If the <code>path</code> references a member of an object that does not exist, a new member is added to the object. We start with our JSON document listing our orders.</p>
<pre class="highlight"><code class="hljs undefined">{
    "orders": [{"id": 123}, {"id": 456}, {"id": 789"}]
}
</code></pre>
<p>Using this JSON Patch document we can add a total and a currency member to the document.</p>
<pre class="highlight"><code class="hljs json">[
{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"add"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/total"</span></span>, "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-number">20.00</span> </span>},
{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"add"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/currency"</span></span>, "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span> </span>}
]
</code></pre>
<p>After applying the patch we get the final representation.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">20.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<h4 id="update-an-existing-member-of-an-object">Update an Existing Member of an Object</h4>
<p>If the <code>path</code> refers to an existing object member, that member is updated with the newly supplied value.</p>
<p>Given the JSON document.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">20.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<p>We can update the total by using an <code>add</code> operation.</p>
<pre class="highlight"><code class="hljs undefined">{ "op": "add", "path": "/total", "value": 30.00 },
</code></pre>
<p>Leaving the final result.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<h3 id="remove">remove</h3>
<p>Remove is a simple operation. The target location of the <code>path</code> is removed from the object.</p>
<p>Starting with the following document.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<p>We can remove the <code>currency</code> member with a <code>remove</code> operation.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"remove"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/currency"</span> </span>}
</code></pre>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span>
</span>}
</code></pre>
<p>We can also remove an element from an array. All remaining elements are shifted one position to the left. To remove order <code>456</code> we can remove the array index referencing this order.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"remove"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/orders/1"</span> </span>}
</code></pre>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span>
</span>}
</code></pre>
<h3 id="replace">replace</h3>
<p>Replace is used to set a new value to a member of the object. It is logically equivalent to a <code>remove</code> operation followed by an <code>add</code> operation to the same <code>path</code> or to an <code>add</code> operation to an existing member. </p>
<p>Given the following JSON document.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">20.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<p>We can apply the <code>replace</code> operation to update the order total.</p>
<pre class="highlight"><code class="hljs undefined">{ "op": "replace", "path": "/total", "value": 30.00 },
</code></pre>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<h3 id="move">move</h3>
<p> The <code>move</code> operation removes the value at a specified location and adds it to the target location. The removal location is given by a <code>from</code> member and the target location is given by the <code>path</code> member.</p>
<p>Given this starting document.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<p>We can move an order to the root of the document by applying this JSON patch.</p>
<pre class="highlight"><code class="hljs bash">json
{ <span class="hljs-string">"op"</span>: <span class="hljs-string">"move"</span>, <span class="hljs-string">"from"</span>: <span class="hljs-string">"/orders/0"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/rootOrder"</span> }
</code></pre><pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">rootOrder</span>": <span class="hljs-value">{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}</span>, 
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<h3 id="copy">copy</h3>
<p><code>copy</code> is like <code>move</code>. It copies the value at the <code>from</code> location to the  <code>path</code> location, leaving duplicates of the data at each location.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"copy"</span></span>, "<span class="hljs-attribute">from</span>": <span class="hljs-value"><span class="hljs-string">"/orders/0"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/rootOrder"</span> </span>}
</code></pre>
<h3 id="test">test</h3>
<p>The HTTP PATCH method is atomic and the patch should only be applied if all operations can be safely applied. The <code>test</code> operation can offer additional validation to ensure that patch preconditions or postconditions are met. If the test fails the whole patch is discarded. <code>test</code> is strictly an equality check.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"test"</span></span>, "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/total"</span> </span>}
</code></pre>
<h3 id="conclusion">Conclusion</h3>
<p>JSON Patch is an effective way to provide diffs of your API resources. Most languages already have an implementation available. There is no reason not to adopt the HTTP PATCH today.</p>

  </div>

  <hr>

  <p>
    


<ul class="list-inline">
  <li>Share this post:</li>
  <li>
    <a href="https://twitter.com/intent/tweet?url=http://sookocheff.com/posts/2014-04-08-understanding-json-patch&amp;text=Understanding JSON Patch&amp;via=soofaloofa">
      <i class="fa fa-twitter fa-lg"></i>
    </a>
  </li>
  <li>
    <a href="https://facebook.com/sharer.php?u=http://sookocheff.com/posts/2014-04-08-understanding-json-patch">
      <i class="fa fa-facebook fa-lg"></i>
    </a>
  </li>
  <li>
    <a href="https://plus.google.com/share?url=http://sookocheff.com/posts/2014-04-08-understanding-json-patch">
      <i class="fa fa-google-plus fa-lg"></i>
    </a>
  </li>
  <li>
    <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://sookocheff.com/posts/2014-04-08-understanding-json-patch">
      <i class="fa fa-linkedin fa-lg"></i>
    </a>
  </li>
  <li>
    <a href="mailto:?subject=Check out this link&amp;body=http://sookocheff.com/posts/2014-04-08-understanding-json-patch">
      <i class="fa fa-envelope fa-lg"></i>
    </a>
  </li>
</ul>


  </p>

  <hr>

  <div class="colored-content">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h4>About Kevin</h4>
      </div>
    </div>

    <div class="row">
      <div class="col-md-2 col-md-offset-2">
        <p>
          <img class="img-circle" src="/img/profile.png">
        </p>
      </div>
      <div class="col-md-6">
        <p>
          I am a Software Developer. I work at <a href="http://www.vendasta.com">VendAsta</a> with a bunch of great people. I run a business as 
<a href="http://redfinchsoftware.com">Red Finch Software</a>. You can find me online as <a href="https://twitter.com/soofaloofa">soofaloofa</a>. I love to teach, learn, speak and write about business and software.

        </p>
      </div>
    </div>

    <div class="row">
      <div class="col-md-offset-4 col-md-6">
        <ul class="list-inline">
          <li>Me on the web:</li>
          <li><a href="http://www.twitter.com/soofaloofa"><i class="fa fa-twitter-square fa-lg"></i></a></li>
          <li><a href="http://www.facebook.com/kevin.sookocheff"><i class="fa fa-facebook-square fa-lg"></i></a></li>
          <li><a href="http://www.linkedin.com/in/kevinsookocheff"><i class="fa fa-linkedin-square fa-lg"></i></a></li>
          <li><a href="https://plus.google.com/+KevinSookocheff"><i class="fa fa-google-plus-square fa-lg"></i></a></li>
          <li><a href="https://github.com/soofaloofa"><i class="fa fa-github-square fa-lg"></i></a></li>
          <li><a href="http://sookocheff.com/rss.xml"><i class="fa fa-rss-square fa-lg"></i></a></li>
        </ul>
      </div>
    </div>
  </div>

  <hr>

  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'kevinsookocheff'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</article>
        </div>
      </section>
    </div>
  </div>
</div>

<!-- Footer -->

<div class="container">
  <footer>
    <div class="row">
      <div class="col-md-12">
        <p class="text-center">
          © Kevin Sookocheff · <a href="#">Top</a>
        </p>
      </div>
    </div>
  </footer>
</div>

<script defer="defer"  src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script defer="defer"  src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
</body>
</html>
