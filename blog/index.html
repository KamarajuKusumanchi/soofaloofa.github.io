<!DOCTYPE html>
<html lang="en">
<head>

<title>Blog | Kevin Sookocheff</title>

<meta charset="utf-8">
<meta http-equiv="content-type", content="text/html; charset=utf-8">
<meta name="viewport", content="width=device-width, initial-scale=1.0">

<meta name="description" content="Tinker. Tailor. Soldier. Sailor.">
<meta name="keywords" content="">
<meta name="author" content="Kevin Sookocheff">

<link  rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" /><link  rel="stylesheet" href="/styles/vendor/bootstrap.min.css" /><link  rel="stylesheet" href="/styles/style.css" /><link  rel="stylesheet" href="/styles/monokai_sublime.css" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-20611089-6', 'sookocheff.com');
  ga('send', 'pageview');
</script>


<!--[if lt IE 9]>
<script async src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.2.0/respond.js"></script>
<![endif]-->

</head>
<body>

<!-- Navbar-->
<div class="navbar navbar-default">
  <div class="container">
    <div class="navbar-header">
      <button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">Kevin Sookocheff</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        
        <li class="active">
          <a href="/blog/">Blog</a>
        </li>
        <li class="inactive">
          <a href="/archives/">Archives</a>
        </li>
        <li class="dropdown">
          <a href="#" data-toggle="dropdown" class="dropdown-toggle">
            Subscribe <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li><a href="http://eepurl.com/KJE01">email</a></li>
            <li><a href="http://sookocheff.com/rss.xml">RSS</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Default Content -->
<!-- Page Container -->
<div class="container">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <section class="page">
        <div class="page-header">
        
          <h1>Blog</h1>
        
        </div>
        <div class="page-content">
          <!-- Page Content -->

  <article>
    <h2><a href="/posts/2014-04-15-app-engine-mapreduce-api-part-1-the-basics">App Engine MapReduce API - Part 1: The Basics</a></h2>
    <small class="text-muted">
      Posted on Tuesday, April 15, 2014.


    </small>

    
      <p>
        <p>This article provides an overview of the <a href="https://developers.google.com/appengine/docs/python/dataprocessing/">App Engine MapReduce API</a>. We will give a basic overview of what MapReduce is and how it is used to do parallel and distributed processing of large datasets.</p>
 
      </p>
    

    
    <p class="text-center">
      <a href="/posts/2014-04-15-app-engine-mapreduce-api-part-1-the-basics"><button type="button" class="btn btn-primary">Read More</button></a>
    </p>
    

    <hr>
  </article>

  <article>
    <h2><a href="/posts/2014-04-08-understanding-json-patch">Understanding JSON Patch</a></h2>
    <small class="text-muted">
      Posted on Tuesday, April 08, 2014.


    </small>

    
      <p>The typical update cycle for an API resource is to (1) GET the representation, (2) modify it and (3) PUT back the entire representation. This can waste bandwidth and processing time for large resources. An alternative is to use the <a href="https://tools.ietf.org/html/rfc5789">HTTP PATCH</a> extension method to only send the differences between two resources. HTTP PATCH applies a set of changes to the document referenced by the HTTP request.</p>
<pre class="highlight"><code class="hljs bash">PATCH /file.txt HTTP/<span class="hljs-number">1.1</span>
Host: sookocheff.com
Content-Type: application/json
If-Match: <span class="hljs-string">"e0036bbc6f"</span>

[description of changes]
</code></pre>
<p>The format of the PATCH request body differs depending on the representation of the resource. For JSON documents, <a href="https://tools.ietf.org/html/rfc6902">JSON Patch</a> defines this format.</p>
<p>A JSON Patch document is a sequential list of operations to be applied to an object. Each operation is a JSON object having exactly one <code>op</code> member.
Valid operations are <code>add</code>, <code>remove</code>, <code>replace</code>, <code>move</code>, <code>copy</code> and <code>test</code>. Any other operation is considered an error. </p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"add"</span> </span>}
</code></pre>
<p>Each operation must also have exactly one <code>path</code> member. 
The <code>path</code> member is a <a href="https://tools.ietf.org/html/rfc6901">JSON Pointer</a> that determines a location within the JSON document to modify.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"add"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/player/name"</span> </span>}
</code></pre>
<p>The remaining elements of a JSON Patch operation depend on the particular operation being performed.</p>
<h3 id="add">add</h3>
<p>The <code>add</code> operation is used in different ways depending on the target of the <code>path</code> being referenced. Generally speaking we can use <code>add</code> to append to a list, add a member to an object or update the value of an existing field. The <code>add</code> operation accepts a <code>value</code> member which is the value to update the referenced <code>path</code>. </p>
<h4 id="append-to-a-list">Append to a List</h4>
<p>To append a value to a list you use an existing list as the <code>path</code> of the operation. So, given the JSON document.</p>
<pre class="highlight"><code class="hljs bash">{
    <span class="hljs-string">"orders"</span>: [{<span class="hljs-string">"id"</span>: <span class="hljs-number">123</span>}, {<span class="hljs-string">"id"</span>: <span class="hljs-number">456</span>}]
}
</code></pre>
<p>We can append an order to the list using the <code>add</code> operation.</p>
<pre class="highlight"><code class="hljs bash">{ <span class="hljs-string">"op"</span>: <span class="hljs-string">"add"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/orders"</span>, <span class="hljs-string">"value"</span>: {<span class="hljs-string">"id"</span>: <span class="hljs-number">789</span>} }
</code></pre>
<p>After applying the patch we get the final document.</p>
<pre class="highlight"><code class="hljs bash">{
    <span class="hljs-string">"orders"</span>: [{<span class="hljs-string">"id"</span>: <span class="hljs-number">123</span>}, {<span class="hljs-string">"id"</span>: <span class="hljs-number">456</span>}, {<span class="hljs-string">"id"</span>: <span class="hljs-number">789</span>}]
}
</code></pre>
<h4 id="add-a-member-to-an-object">Add a Member to an Object</h4>
<p>If the <code>path</code> references a member of an object that does not exist, a new member is added to the object. We start with our JSON document listing our orders.</p>
<pre class="highlight"><code class="hljs undefined">{
    "orders": [{"id": 123}, {"id": 456}, {"id": 789"}]
}
</code></pre>
<p>Using this JSON Patch document we can add a total and a currency member to the document.</p>
<pre class="highlight"><code class="hljs json">[
{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"add"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/total"</span></span>, "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-number">20.00</span> </span>},
{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"add"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/currency"</span></span>, "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span> </span>}
]
</code></pre>
<p>After applying the patch we get the final representation.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">20.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<h4 id="update-an-existing-member-of-an-object">Update an Existing Member of an Object</h4>
<p>If the <code>path</code> refers to an existing object member, that member is updated with the newly supplied value.</p>
<p>Given the JSON document.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">20.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<p>We can update the total by using an <code>add</code> operation.</p>
<pre class="highlight"><code class="hljs undefined">{ "op": "add", "path": "/total", "value": 30.00 },
</code></pre>
<p>Leaving the final result.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<h3 id="remove">remove</h3>
<p>Remove is a simple operation. The target location of the <code>path</code> is removed from the object.</p>
<p>Starting with the following document.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<p>We can remove the <code>currency</code> member with a <code>remove</code> operation.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"remove"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/currency"</span> </span>}
</code></pre>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span>
</span>}
</code></pre>
<p>We can also remove an element from an array. All remaining elements are shifted one position to the left. To remove order <code>456</code> we can remove the array index referencing this order.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"remove"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/orders/1"</span> </span>}
</code></pre>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span>
</span>}
</code></pre>
<h3 id="replace">replace</h3>
<p>Replace is used to set a new value to a member of the object. It is logically equivalent to a <code>remove</code> operation followed by an <code>add</code> operation to the same <code>path</code> or to an <code>add</code> operation to an existing member. </p>
<p>Given the following JSON document.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">20.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<p>We can apply the <code>replace</code> operation to update the order total.</p>
<pre class="highlight"><code class="hljs undefined">{ "op": "replace", "path": "/total", "value": 30.00 },
</code></pre>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<h3 id="move">move</h3>
<p> The <code>move</code> operation removes the value at a specified location and adds it to the target location. The removal location is given by a <code>from</code> member and the target location is given by the <code>path</code> member.</p>
<p>Given this starting document.</p>
<pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<p>We can move an order to the root of the document by applying this JSON patch.</p>
<pre class="highlight"><code class="hljs bash">json
{ <span class="hljs-string">"op"</span>: <span class="hljs-string">"move"</span>, <span class="hljs-string">"from"</span>: <span class="hljs-string">"/orders/0"</span>, <span class="hljs-string">"path"</span>: <span class="hljs-string">"/rootOrder"</span> }
</code></pre><pre class="highlight"><code class="hljs json">{
    "<span class="hljs-attribute">orders</span>": <span class="hljs-value">[{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">456</span></span>}, {"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">789</span></span>}]</span>,
    "<span class="hljs-attribute">rootOrder</span>": <span class="hljs-value">{"<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">123</span></span>}</span>, 
    "<span class="hljs-attribute">total</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>,
    "<span class="hljs-attribute">currency</span>": <span class="hljs-value"><span class="hljs-string">"USD"</span>
</span>}
</code></pre>
<h3 id="copy">copy</h3>
<p><code>copy</code> is like <code>move</code>. It copies the value at the <code>from</code> location to the  <code>path</code> location, leaving duplicates of the data at each location.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"copy"</span></span>, "<span class="hljs-attribute">from</span>": <span class="hljs-value"><span class="hljs-string">"/orders/0"</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/rootOrder"</span> </span>}
</code></pre>
<h3 id="test">test</h3>
<p>The HTTP PATCH method is atomic and the patch should only be applied if all operations can be safely applied. The <code>test</code> operation can offer additional validation to ensure that patch preconditions or postconditions are met. If the test fails the whole patch is discarded. <code>test</code> is strictly an equality check.</p>
<pre class="highlight"><code class="hljs json">{ "<span class="hljs-attribute">op</span>": <span class="hljs-value"><span class="hljs-string">"test"</span></span>, "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-number">30.00</span></span>, "<span class="hljs-attribute">path</span>": <span class="hljs-value"><span class="hljs-string">"/total"</span> </span>}
</code></pre>
<h3 id="conclusion">Conclusion</h3>
<p>JSON Patch is an effective way to provide diffs of your API resources. Most languages already have an implementation available. There is no reason not to adopt the HTTP PATCH today.</p>

    

    

    <hr>
  </article>

  <article>
    <h2><a href="/posts/2014-04-01-how-to-version-a-rest-api">How to Version a REST API</a></h2>
    <small class="text-muted">
      Posted on Tuesday, April 01, 2014.


    </small>

    
      <p>API versioning is a fact of life. Even the most well designed API changes as new features and relationships are uncovered. Unfortunately, updating an API is seldom as simple as changing the behaviour of our existing URL endpoints on her he server. If we have existing clients we need to explicitly advertise breaking changes in a seamless way. This article explains a few methods of specifying breaking changes that offer a clear upgrade path for existing API clients. </p>
<h3 id="1-versioned-url">1) Versioned URL</h3>
<p>URL versioning inserts a version number directly in the URL of the resource. As an example,  version one of the API could be accessed through the <code>v1</code> URL.</p>
<pre class="highlight"><code class="hljs bash">http://sookocheff.com/api/v1/users/<span class="hljs-number">12345</span>
</code></pre>
<p>Version two of the API could be accessed through the <code>v2</code> URL. </p>
<pre class="highlight"><code class="hljs bash">http://sookocheff.com/api/v2/users/<span class="hljs-number">12345</span>
</code></pre>
<p>This solution has been widely adopted because it is easy to deploy and easy for client developers to understand. This method also makes each API version discoverable and browseable without using an advanced HTTP client — just alter the URL. </p>
<p>The drawback to using URL versioning is that by changing the URL of a resource with each new API version we are violating the REST constraint that <a href="http://sookocheff.com/posts/2014-03-19-how-rest-constraints-affect-api-design/">each resource be accessible via a unique URL</a>. To mitigate this you can map the current version of the API to a non-versioned URL.</p>
<pre class="highlight"><code class="hljs bash">http://sookocheff.com/api/users/
</code></pre>
<p>Once this mapping is in place you can safely deprecate old URLs by redirecting to the non-versioned URL -- notifying the client to use the latest version. At all times the non-versioned URL represents the latest version of that resource.</p>
<h4 id="pros-">Pros:</h4>
<ul>
<li>Easy to implement.</li>
<li>Easy to understand.</li>
<li>Direct path to deprecation.</li>
</ul>
<h4 id="cons-">Cons:</h4>
<ul>
<li>Violates REST principle of unique URLs for a resource.</li>
</ul>
<h3 id="2-versioned-media-type">2) Versioned Media Type</h3>
<p>When making an HTTP request the client can request a specific MIME type (or list of MIME types) that it is willing to accept using an <code>Accept</code> header. For example, an HTML client may use the following <code>Accept</code> header to request an HTML representation of the resource.</p>
<pre class="highlight"><code class="hljs http"><span class="hljs-request">GET <span class="hljs-string">/v1/users/12345</span> HTTP/1.1</span>
<span class="hljs-attribute">Host</span>: <span class="hljs-string">sookocheff.com</span>
<span class="hljs-attribute">Accept</span>: <span class="hljs-string">text/html</span>
</code></pre><p>Whereas an XML client may use the following <code>Accept</code> header to request an XML representation of the resource.</p>
<pre class="highlight"><code class="hljs http"><span class="hljs-request">GET <span class="hljs-string">/v1/users/12345</span> HTTP/1.1</span>
<span class="hljs-attribute">Host</span>: <span class="hljs-string">sookocheff.com</span>
<span class="hljs-attribute">Accept</span>: <span class="hljs-string">application/xml</span>
</code></pre><p>We can use this functionality to allow the client to access specific versions of a resource.</p>
<pre class="highlight"><code class="hljs http"><span class="hljs-request">GET <span class="hljs-string"></span> /users/12345 <span class="hljs-string">HTTP/1.1
Host:</span> sookocheff.com</span>
<span class="hljs-attribute">Accept</span>: <span class="hljs-string">application/vnd.sookocheff.user+json?version=2</span>
</code></pre><p>This method assumes we have defined a custom media type to represent every resource in our API and that the media type accepts a <code>version</code> parameter.</p>
<p>Versioning the media type does adhere to strict REST principles but causes problems in other ways. First, you need a custom media type for every resource returned by your API. This is not only reinventing the wheel -- <a href="http://schema.org/">perfectly good</a> <a href="http://www.iana.org/assignments/media-types/media-types.xhtml">media types</a> <a href="http://www.freeformatter.com/mime-types-list.html">already exist</a> -- it also creates a media type so specific to your API that it cannot be reused elsewhere. Lastly, it is unclear whether the version parameter applies to the version of the media type or to the version of your API.</p>
<h4 id="pros-">Pros:</h4>
<ul>
<li>Adheres to REST principles.</li>
</ul>
<h4 id="cons-">Cons:</h4>
<ul>
<li>Custom media type for every resource.</li>
<li>Binds your media type to your API.</li>
<li>Unclear versioning.</li>
<li>Requires sophisticated API client.</li>
</ul>
<h3 id="3-versioned-http-header">3) Versioned HTTP Header</h3>
<p>The <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec7.html#sec7.1">HTTP specification</a> states that unknown HTTP headers MUST be forwarded on to the recipient. This means that custom HTTP headers can be set by our client and received by our API.</p>
<pre class="highlight"><code class="hljs bash">GET /users/<span class="hljs-number">12345</span> HTTP/<span class="hljs-number">1.1</span>
Host: sookocheff.com
Accept: application/json
Users-Version: <span class="hljs-number">2</span>
</code></pre>
<p>A server receiving this request can parse the header to ascertain the version number being requested by the client and return the proper representation. </p>
<p>This method requires that your API client is able to modify the HTTP headers of its requests. If the client is unable to provide a version number with the HTTP header you can assume that a request is made for the latest API version.</p>
<h4 id="pros-">Pros:</h4>
<ul>
<li>Adheres to REST principles.</li>
</ul>
<h4 id="cons-">Cons:</h4>
<ul>
<li>Requires sophisticated API client.</li>
</ul>
<h3 id="4-versioned-resources">4) Versioned Resources</h3>
<p>The last versioning method is to set the version number in the response itself. This places the burden of versioning with the client rather than the server. A client receiving a response from a known version number can parse it and act appropriately. It would be up to the client how to handle an unknown version number.</p>
<p>This method is only appropriate if you as the developer have direct control over both the server and the client being deployed.</p>
<h4 id="pros-">Pros:</h4>
<ul>
<li>Simplified server.</li>
</ul>
<h4 id="cons-">Cons:</h4>
<ul>
<li>Complex client.</li>
<li>Tightly couples server to client.</li>
</ul>
<h3 id="what-to-do-">What to do?</h3>
<p>By following <a href="http://sookocheff.com/posts/2014-03-19-how-rest-constraints-affect-api-design/">REST principles</a> we can guide our API versioning practices while being pragmatic about our choices so that our API can work in the real world.</p>
<p>My recommendation is to combine versioned URLs with custom HTTP headers using the following guidelines. With these guidelines we can safely version our API while supporting existing clients and offering them a clear upgrade path.</p>
<ol>
<li>Each major version of the API recieves a versioned URL.</li>
<li>One non-versioned URL always represents the latest API version. </li>
<li>Redirect deprecated URLs to the canonical URL after an advertised grace period.</li>
<li>Add a custom HTTP header for the version number.<ul>
<li>This header specifies both major <strong>and</strong> minor version numbers.</li>
<li>The non-versioned URL returns the appropriate version of the resource when specified by the HTTP header.</li>
</ul>
</li>
</ol>
<h3 id="references">References</h3>
<p><a href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api">Vinay Sahni</a> has collected a long list of best practices for pragmatic API design, including versioning. </p>
<p><a href="http://stackoverflow.com/questions/389169/best-practices-for-api-versioning">stackoverflow</a> presents a collection of good answers providing best practices for API versioning.</p>

    

    

    <hr>
  </article>

  <article>
    <h2><a href="/posts/2014-03-27-when-to-use-http-put-and-http-post">When to Use HTTP PUT and HTTP POST</a></h2>
    <small class="text-muted">
      Posted on Thursday, March 27, 2014.


    </small>

    
      <p>The HTTP protocol defines two methods for updating a resource -- <code>PUT</code> and
<code>POST</code>. Both <code>PUT</code> and <code>POST</code> are used to modify a resource and this semantic
similarity can confuse API developers. This confusion has led most developers to
use <code>POST</code> for any action which may modify the state of a resource, ignoring
<code>PUT</code> entirely.</p>
<p>This article attempts to explain the semantics behind the <code>PUT</code> and <code>POST</code>
methods and offers clear suggestions on when to use each method.</p>
<h3 id="put">PUT</h3>
<p>Let&#39;s go <a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">straight to the HTTP/1.1 RFC</a> for the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.6">definition of PUT</a>.</p>
<blockquote>
<p>The PUT method requests that the enclosed entity be stored under the supplied
Request-URI. If the Request-URI refers to an already existing resource, the
enclosed entity SHOULD be considered as a modified version of the one residing
on the origin server. If the Request-URI does not point to an existing
resource ... the origin server can create the resource with that URI.</p>
</blockquote>
<p>The PUT specification requires that you already know the URL of the resource you
wish to create or update. On create, if the client chooses the identifier for a
resource a PUT request will create the new resource at the specified URL.</p>
<pre class="highlight"><code class="hljs http"><span class="hljs-request">PUT <span class="hljs-string">/user/1234567890</span> HTTP/1.1</span>
<span class="hljs-attribute">Host</span>: <span class="hljs-string">http://sookocheff.com</span>

<span class="json">{
    "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"Kevin Sookocheff"</span></span>,
    "<span class="hljs-attribute">website</span>": <span class="hljs-value"><span class="hljs-string">"http://kevinsookocheff.com"</span>
</span>}
</span></code></pre><p>The server could respond with a <code>201 Created</code> status code and the new resource&#39;s
location.</p>
<pre class="highlight"><code class="hljs http"><span class="hljs-status">HTTP/1.1 <span class="hljs-number">201</span> Created</span>
<span class="hljs-attribute">Location</span>: <span class="hljs-string">/user/1234567890</span>
</code></pre><p>In addition, if you know that a resource already exists for a URL, you can make
a PUT request to that URL to replace the state of that resource on the server.
This example updates the user&#39;s website.</p>
<pre class="highlight"><code class="hljs http"><span class="hljs-request">PUT <span class="hljs-string">/user/1234567890</span> HTTP/1.1</span>
<span class="hljs-attribute">Host</span>: <span class="hljs-string">http://sookocheff.com</span>

<span class="json">{
    "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"Kevin Sookocheff"</span></span>,
    "<span class="hljs-attribute">website</span>": <span class="hljs-value"><span class="hljs-string">"http://sookocheff.com"</span>
</span>}
</span></code></pre><p>In general the HTTP PUT method replaces the resource at the current URL with the
resource contained within the request. PUT is used to both create and update the
state of a resource on the server. </p>
<h3 id="post">POST</h3>
<p>Let&#39;s go <a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">back to the HTTP/1.1 RFC</a> for the <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.5">definition of POST</a>.</p>
<blockquote>
<p>The POST method is used to request that the origin server accept the entity
enclosed in the request as a new subordinate of the resource identified by the
Request-URI ...  The posted entity is subordinate to that URI in the same way
that a file is subordinate to a directory containing it, a news article is
subordinate to a newsgroup to which it is posted, or a record is subordinate
to a database.</p>
</blockquote>
<p>Practically speaking, POST is used to append a resource to an existing
collection. In the following example you do not know the actual URL of the
resource -- the server decides the location where it is stored under the
<code>user</code> collection. </p>
<pre class="highlight"><code class="hljs http"><span class="hljs-request">POST <span class="hljs-string">/user</span> HTTP/1.1</span>
<span class="hljs-attribute">Host</span>: <span class="hljs-string">http://sookocheff.com</span>

<span class="json">{
    "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"Bryan Larson"</span></span>,
    "<span class="hljs-attribute">website</span>": <span class="hljs-value"><span class="hljs-string">"http://www.bryanlarson.ca"</span>
</span>}
</span></code></pre><p>The server could respond with a <code>201 Created</code> status code and the resource&#39;s new
location.</p>
<pre class="highlight"><code class="hljs http"><span class="hljs-status">HTTP/1.1 <span class="hljs-number">201</span> Created</span>
<span class="hljs-attribute">Location</span>: <span class="hljs-string">/user/636363</span>
</code></pre><p>Subsequent updates to this user would be made through a <code>PUT</code> request to the
specific URL for the user - <code>/user/636363</code>.</p>
<p>The book <a href="http://www.amazon.ca/RESTful-Web-APIs-Leonard-Richardson/dp/1449358063">RESTful Web APIs</a>
classify this behaviour <em>POST-to-append</em> and is the generally recommended way to
handle a POST request within the context of a specific resource.</p>
<h2 id="putting-it-together">Putting it Together</h2>
<p>The <a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">HTTP/1.1 RFC</a> offers some guidance on <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.6">distinguishing between POST and
PUT</a>.</p>
<blockquote>
<p>The fundamental difference between the POST and PUT requests is reflected in
the different meaning of the Request-URI. The URI in a POST request identifies
the resource that will handle the enclosed entity ...  In contrast, the URI in
a PUT request identifies the entity enclosed with the request.</p>
</blockquote>
<p>By following the existing semantics of the HTTP PUT and POST methods we can
begin to take advantage of the <a href="http://sookocheff.com/posts/2014-03-19-how-rest-constraints-affect-api-design/">benefits of REST</a> to write scalable and
robust APIs. Not only is your API ready to scale and easy to maintain, it is
easy to understand and use. By consistently following these existing semantics
you can avoid inserting special cases and &#39;gotchas&#39; into your API that confuse
client developers.</p>

    

    

    <hr>
  </article>

  <article>
    <h2><a href="/posts/2014-03-25-stripe-checkout-opening-in-a-new-tab">Stripe checkout opening in a new tab</a></h2>
    <small class="text-muted">
      Posted on Tuesday, March 25, 2014.


    </small>

    
      <p>At <a href="http://www.vendasta.com">VendAsta</a> we&#39;ve been integrating with the <a href="http://stripe.com/checkout">Stripe</a> payment system using Stripe Checkout. The experience has been completely painless and surprisingly simple. Then came a hiccup. While demoing the new functionality we found that one particular computer in the office would open the checkout modal dialog in a new browser window. Just one laptop. It was running the same version of Chrome that we were developing on. It was running the same OS as a working test machine. But the dialog would consistently open in a new browser window on just this one laptop. </p>
<p>After a Friday afternoon debugging session our Product Owner decided to jump onto IRC and chat directly with the Stripe developers. They were quickly able to diagnose our problem: touch. The troublesome laptop was a Windows 8 machine with a touch display — and Stripe Checkout will open in a new browser window when used on a tablet.</p>
<p>This episode was a great reminder of how the first step in debugging is often to <a href="http://www.hanselman.com/blog/BackToBasicsAssertYourAssumptionsAndDiffYourSourceCode.aspx">find the difference between the working and non-working system</a>. Hopefully this post will help someone else with the same problem. </p>
<p>P.S. Kudos to Stripe for their prompt help via IRC.</p>

    

    

    <hr>
  </article>


<!-- Page Listing -->
<div>
  <ul class="pager">
    <!-- Previous Page Button -->
    
      <li class="previous"><a href="/blog.1">← Older</a></li>
    

    <!-- Archives -->
    <li><a href="/archives/">Archives</a></li>

    <!-- Next Page Button -->
    
      <li class="next disabled"><span>Newer</span></li>
    
  </ul>
</div>
        </div>
      </section>
    </div>
  </div>
</div>

<!-- Footer -->
<div class="container">
  <hr>
  <footer>
    <p class="pull-right">
      <a href="#" class="pull-right">Top</a>
    </p>
    <p>
    © Kevin Sookocheff
    </p>
  </footer>
</div>

<script defer="defer"  src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script defer="defer"  src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
</body>
</html>
