<!DOCTYPE html>
<html lang="en">
<head>

<title>App-Engine : sookocheff.com</title>

<meta charset="utf-8">
<meta http-equiv="content-type", content="text/html; charset=utf-8">
<meta name="viewport", content="width=device-width, initial-scale=1.0">

<link rel="canonical" href="http://sookocheff.com/tags/app-engine">

<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Bree+Serif">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans">
<link rel="stylesheet" href="//yandex.st/highlightjs/8.0/styles/default.min.css">

<link rel="stylesheet" href="/css/vendor/bootstrap.min.css">
<link rel="stylesheet" href="/css/vendor/monokai_sublime.css">
<link rel="stylesheet" href="/css/style.css">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-20611089-6', 'sookocheff.com');
  ga('send', 'pageview');
</script>




</head>
<body>

<div class="navbar navbar-default" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">Kevin Sookocheff</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li class="">
          <a href="/posts/">Blog</a>
        </li>
        <li class="dropdown">
          <a href="#" data-toggle="dropdown" class="dropdown-toggle">
            Subscribe <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li><a href="http://eepurl.com/KJE01">email</a></li>
            <li><a href="http://sookocheff.com/index.xml">RSS</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>


<div class="container page-container">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <section class="page">
        <h1>App-Engine</h1>

        
          <article>
            <h2><a href="http://sookocheff.com/posts/2014-07-02-creating-restful-apis-with-cloud-endpoints">Creating RESTful APIs with App Engine Cloud Endpoints</a></h2>
            <small class="text-muted">
              Posted on Wednesday, July 2, 2014.
            </small>
            
              <p>
                <p><a href="https://developers.google.com/appengine/docs/python/endpoints/">App Engine Cloud
Endpoints</a> can
is a great way to quickly and easily create JSON API endpoints. What&rsquo;s not clear
is how to structure your <code>Message</code> code to support a RESTful
create-read-update-delete (CRUD) API. This article will show the basic CRUD
operations for one Resource. The results can easily be adapted to support a full
REST API.</p>

<p>To support this discussion let&rsquo;s use a concrete resource for our API &ndash; a <code>User</code>
resource. We can give our <code>User</code> model a few simple attributes.</p>

<p><a class="thumbnail" href="/img/2014-07-02-creating-restful-apis-with-app-engine-cloud-endpoints/user-model.png">
<img src="/img/2014-07-02-creating-restful-apis-with-app-engine-cloud-endpoints/user-model.png" alt="Player Resource">
</a></p>

<p>A CRUD API for this resource would support a URL structure and HTTP verbs
for each operation.</p>

<pre><code class="bash"># Create a new user
HTTP POST /users/

# Read a user by id
HTTP GET /users/{id}

# Update a user by id
HTTP PUT /users/{id}

# Delete a user by id
HTTP DELETE /users/{id}
</code></pre>

<p>Given our model we can define a basic Cloud Endpoints message representing a <code>User</code>.</p>

<pre><code class="python">class UserMessage(messages.Message):
    id = messages.StringField(1)
    email = messages.StringField(2)
    username = messages.StringField(3)
</code></pre>

<p>Now we can write the <strong>C</strong> (create) portion of our CRUD API using HTTP POST
and a <code>ResourceContainer</code> to hold the message we wish to submit to the API.</p>

<pre><code class="python">POST_RESOURCE = endpoints.ResourceContainer(UserMessage)

...

@endpoints.method(POST_RESOURCE,
                  UserMessage,
                  path='/users',
                  http_method='POST',
                  name='users.create')
def create(self, request):
    user = User(username=request.username, email=request.email)
    user.put()
    return user.to_message()
</code></pre>

<p>Similarly we can define our <strong>R</strong> (read) portion of the API using an HTTP GET
method. To parameterize our cloud endpoint we need to add the parameter to our
<code>ResourceContainer</code>. I&rsquo;ll call it <code>id</code> here. The actual message type is
<code>VoidMessage</code> because we are not passing any information in our request to the
API endpoint other than the <code>id</code> parameter.</p>

<p>Our response simply gets the entity from the datastore and returns it as a
message.</p>

<pre><code class="python">ID_RESOURCE = endpoints.ResourceContainer(message_types.VoidMessage,
                                          id=messages.StringField(1,
                                                                  variant=messages.Variant.STRING,
                                                                  required=True))

...

@endpoints.method(ID_RESOURCE,
                  UserMessage,
                  http_method='GET',
                  path='users/{id}',
                  name='users.read')
def read(self, request):
    entity = User.get_by_id(request.id)
    if not entity:
        message = 'No User with the id &quot;%s&quot; exists.' % request.id
        raise endpoints.NotFoundException(message)

    return entity.to_message()
</code></pre>

<p>The <strong>U</strong> (update) operation uses a similar parameterized <code>ResourceContainer</code> to
access a User given an id. We augment this request with the <code>UserMessage</code> which
defines the content of the body of the message. The endpoint takes the content
of the message and updates the entity with that content.</p>

<pre><code class="python">PUT_RESOURCE = endpoints.ResourceContainer(UserMessage,
                                           id=messages.StringField(1,
                                                                   variant=messages.Variant.STRING,
                                                                   required=True))

...

@endpoints.method(PUT_RESOURCE,
                  UserMessage,
                  http_method='PUT',
                  path='users/{id}',
                  name='users.update')
def update(self, request):
    entity = User.update_from_message(request.id, request)
    if not entity:
        message = 'No User with the id &quot;%s&quot; exists.' % request.id
        raise endpoints.NotFoundException(message)

    return entity.to_message()
</code></pre>

<p>Lastly, the <strong>D</strong> (delete) endpoint takes an identifier which we have previously
defined as <code>ID_RESOURCE</code>. The endpoint deletes the entity referred to by that
identifier and returns a <code>VoidMessage</code> which is converted to an <code>HTTP 204 No
Content</code> response by the cloud endpoints API.</p>

<pre><code class="python">@endpoints.method(ID_RESOURCE,
                  message_types.VoidMessage,
                  http_method='DELETE',
                  path='users/{id}',
                  name='users.delete')
def delete(self, request):
    entity = User.get_by_id(request.id)
    if not entity:
        message = 'No User with the id &quot;%s&quot; exists.' % request.id
        raise endpoints.NotFoundException(message)

    entity.key.delete()
    return message_types.VoidMessage()
</code></pre>

<p>This basic pattern can be used with any resource that your API wishes to
support and gives a basic pattern with which to build out your full API.</p>

<p>If you have any questions please send me an email or let me know in the
comments!</p>

              </p>
            
            <hr>
          </article>
        
          <article>
            <h2><a href="http://sookocheff.com/posts/2014-06-23-running-multiple-app-engine-modules-locally">Running Multiple App Engine Modules Locally with dev_appserver.py</a></h2>
            <small class="text-muted">
              Posted on Tuesday, June 17, 2014.
            </small>
            
              <p>
                <p>The recently released <a href="https://developers.google.com/appengine/docs/python/modules/">App Engine Modules API</a> allows developers to compartmentalize their applications into logical units that can share state using the datastore or memcache.</p>

<p>The documentation for this API is fairly complete but one part is lacking â€” running multiple modules locally using dev_appserver.py. Thankfully, the solution is not too complicated.  Just pass the list of <code>.yaml</code> files defining your modules to dev_appserver and it will run all of your modules locally.</p>

<pre><code class="bash">dev_appserver.py src/app.yaml src/backend.yaml src/dispatch.yaml
</code></pre>

              </p>
            
            <hr>
          </article>
        
          <article>
            <h2><a href="http://sookocheff.com/posts/2014-05-28-how-to-bypass-the-auto-now-property-option-during-an-ndb-put">How to bypass the auto_now property option during an ndb put</a></h2>
            <small class="text-muted">
              Posted on Wednesday, May 28, 2014.
            </small>
            
              <p>
                <p>In App Engine the <code>auto_now</code> option sets a property to the current date/time
whenever the entity is created or updated. This is a great feature for tracking
the time when an entity was last updated. However, sometimes you may want to put
an entity without updating an <code>auto_now</code> timestamp. This article will show you
how.</p>

<p>First, let&rsquo;s start with a very basic ndb model with an <code>updated</code> property having
the <code>auto_now</code> option set to <code>True</code>.</p>

<pre><code class="python">from google.appengine.ext import ndb

class Article(ndb.model):
    title = ndb.model.StringProperty()
    updated = ndb.model.DateTimeProperty(auto_now=True)
</code></pre>

<p>Now, let&rsquo;s put the entity to the datastore <em>without updating the timestamp</em> and
<em>completely bypassing the <code>auto_now</code> option</em>.</p>

<pre><code class="python">article = Article(title='Python versus Ruby')
article._properties['updated']._auto_now = False
article.put()
</code></pre>

<p>It&rsquo;s pretty simple, but with caveats. Putting the entity using the code above
will store the updated entity in the instance cache (and memcache). If we get
the entity it will be retrieved from the instance cache with the <code>auto_now</code>
property still set to <code>False</code>. This can have unwanted side-effects because
subsequent updates to the entity will not trigger the <code>auto_now</code> functionality.</p>

<pre><code class="python">article = Article(title='Python versus Ruby')
article._properties['updated']._auto_now = False
key = article.put() # Put the entity with the auto_now option set to False

article = key.get() # Get the entity from instance cache
article.title = 'Python versus Go'
article.put() # Put the entity with the auto_now option *still* set to False
</code></pre>

<p>You can set the <code>auto_now</code> option to <code>True</code> again to re-enable the functionality.</p>

<pre><code class="python">article = Article(title='Python versus Ruby')
article._properties['updated']._auto_now = False
key = article.put()

article._properties['updated']._auto_now = True
article = key.get() # Get the entity from instance cache
article.title = 'Python versus Go'
article.put() # Puts the entity with the auto_now option set to True
</code></pre>

<p>For more information on ndb caching <a href="https://developers.google.com/appengine/docs/python/ndb/cache">refer to the
documentation</a>.</p>

              </p>
            
            <hr>
          </article>
        
          <article>
            <h2><a href="http://sookocheff.com/posts/2014-05-20-app-engine-mapreduce-api-part-5-using-combiners-to-reduce-data-throughput">App Engine MapReduce API - Part 5: Using Combiners to Reduce Data Throughput</a></h2>
            <small class="text-muted">
              Posted on Tuesday, May 20, 2014.
            </small>
            
              <p>
                In this post we will look at how to reduce the amount of data transfer during a MapReduce job using a combiner.
              </p>
              <p class="text-center">
                <a href="http://sookocheff.com/posts/2014-05-20-app-engine-mapreduce-api-part-5-using-combiners-to-reduce-data-throughput"><button type="button" class="btn btn-primary">Read More</button></a>
              </p>
            
            <hr>
          </article>
        
          <article>
            <h2><a href="http://sookocheff.com/posts/2014-05-13-app-engine-mapreduce-api-part-4-combining-sequential-mapreduce-jobs">App Engine MapReduce API - Part 4: Combining Sequential MapReduce Jobs</a></h2>
            <small class="text-muted">
              Posted on Tuesday, May 13, 2014.
            </small>
            
              <p>
                In this post we will see how to chain multiple MapReduce Pipelines together to perform sequential tasks.
              </p>
              <p class="text-center">
                <a href="http://sookocheff.com/posts/2014-05-13-app-engine-mapreduce-api-part-4-combining-sequential-mapreduce-jobs"><button type="button" class="btn btn-primary">Read More</button></a>
              </p>
            
            <hr>
          </article>
        
          <article>
            <h2><a href="http://sookocheff.com/posts/2014-04-30-app-engine-mapreduce-api-part-3-programmatic-mapreduce-using-pipelines">App Engine MapReduce API - Part 3: Programmatic MapReduce using Pipelines</a></h2>
            <small class="text-muted">
              Posted on Monday, April 28, 2014.
            </small>
            
              <p>
                In this article we will take our exploration of MapReduce a step further by looking at how to run a MapReduce job programmatically using the App Engine Pipeline API.
              </p>
              <p class="text-center">
                <a href="http://sookocheff.com/posts/2014-04-30-app-engine-mapreduce-api-part-3-programmatic-mapreduce-using-pipelines"><button type="button" class="btn btn-primary">Read More</button></a>
              </p>
            
            <hr>
          </article>
        
          <article>
            <h2><a href="http://sookocheff.com/posts/2014-04-22-app-engine-mapreduce-api-part-2-running-a-mapreduce-job-using-mapreduceyaml">App Engine MapReduce API - Part 2: Running a MapReduce Job Using mapreduce.yaml</a></h2>
            <small class="text-muted">
              Posted on Tuesday, April 22, 2014.
            </small>
            
              <p>
                In this article we&#39;ll be getting our hands dirty writing some code to handle the Map Stage. The Map Stage is composed of two separate components: an InputReader and a map function. We&#39;ll look at each of these in turn and show how to run some basic MapReduce jobs using the App Engine API.
              </p>
              <p class="text-center">
                <a href="http://sookocheff.com/posts/2014-04-22-app-engine-mapreduce-api-part-2-running-a-mapreduce-job-using-mapreduceyaml"><button type="button" class="btn btn-primary">Read More</button></a>
              </p>
            
            <hr>
          </article>
        
          <article>
            <h2><a href="http://sookocheff.com/posts/2014-04-15-app-engine-mapreduce-api-part-1-the-basics">App Engine MapReduce API - Part 1: The Basics</a></h2>
            <small class="text-muted">
              Posted on Tuesday, April 15, 2014.
            </small>
            
              <p>
                This article provides an overview of the App Engine MapReduce API. We will give a basic overview of what MapReduce is and how it is used to do parallel and distributed processing of large datasets.
              </p>
              <p class="text-center">
                <a href="http://sookocheff.com/posts/2014-04-15-app-engine-mapreduce-api-part-1-the-basics"><button type="button" class="btn btn-primary">Read More</button></a>
              </p>
            
            <hr>
          </article>
        
      </section>
    </div>
  </div>
</div>

<footer>
 <div class="footer-above text-center">
   <div class="container">
     <div class="row">
       <div class="footer-col col-md-3">
         <h3>App Engine</h3>
         <ul class="list-unstyled">
           <li>
             <a href="/series/mapreduce-api/">MapReduce API</a>
           </li>
         </ul>
       </div>

       <div class="footer-col col-md-3">
         <h3>APIs</h3>
         <ul class="list-unstyled">
           <li>
             <a href="/posts/2014-03-11-on-choosing-a-hypermedia-format/">On Choosing a Hypermedia Format</a>
           </li>
           <li>
             <a href="/posts/2014-03-27-when-to-use-http-put-and-http-post/">When to use HTTP PUT</a>
           </li>
         </ul>
       </div>

       <div class="footer-col col-md-3">
         <h3>Popular</h3>
         <ul class="list-unstyled">
           <li>
           <a href="http://sookocheff.com/posts/2013-04-09-submitting-a-unity3d-game-to-the-mac-app-store/"> Unity3d on the Mac App Store</a>
           </li>
           <li>
             <a href="http://sookocheff.com/posts/2011-07-27-saving-canvas-data-to-an-image-file-with-javascript-and-php/">Saving Canvas Data to an Image</a>
           </li>
         </ul>
       </div>

       <div class="footer-col col-md-3">
         <h3>Social</h3>
         <ul class="list-unstyled">
           <li><a href="http://www.twitter.com/soofaloofa">Twitter</a></li>
           <li><a href="http://www.facebook.com/kevin.sookocheff">Facebook</a></li>
           <li><a href="http://www.linkedin.com/in/kevinsookocheff">LinkedIn</a></li>
           <li><a href="https://plus.google.com/+KevinSookocheff">Google+</a></li>
           <li><a href="https://github.com/soofaloofa">Github</a></li>
         </ul>
       </div>
     </div>
   </div>
 </div>
 <div class="footer-below text-center">
     <div class="container">
         <div class="row">
             <div class="col-lg-12">
                 &copy; Kevin Sookocheff Â· <a href="#">Top</a>
             </div>
         </div>
     </div>
 </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="//yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script src="/js/vendor/retina.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>

